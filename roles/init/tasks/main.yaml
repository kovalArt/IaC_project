---

- name: Update APT cache
  ansible.builtin.apt:
    cache_valid_time: 86400       

- name: Install Prometheus nodes
  become: yes
  apt:    
    name:
      prometheus-node-exporter
    state: present

- name: Ensure the Node Exporters are started
  become: yes
  service: 
    name: prometheus-node-exporter
    state: started
    enabled: true 

- name: Ensure ca-certificates is installed with a specific version
  apt:
    name: ca-certificates=20230311ubuntu0.20.04.1
    state: present
  become: yes

- name: Install Rsyslog
  apt:
    name: rsyslog
    state: present

- name: Add the Rsyslog configuration for the Telegraf 
  template:
    src: rsyslog.conf.j2
    dest: /etc/rsyslog.d/50-telegraf.conf

