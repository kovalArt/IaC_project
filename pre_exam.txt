Tue Jan 16 09:55:03 EET 2024
+ hostname
MacBook-Pro-Artem.local
+ ansible-playbook infra.yaml --diff

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [init : Update APT cache] *************************************************
ok: [kovalart-3]
changed: [kovalart-2]
changed: [kovalart-1]

TASK [init : Install Prometheus nodes] *****************************************
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 267 not upgraded.
changed: [kovalart-3]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 267 not upgraded.
changed: [kovalart-2]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 267 not upgraded.
changed: [kovalart-1]

TASK [init : Ensure the Node Exporters are started] ****************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [init : Ensure ca-certificates is installed with a specific version] ******
The following packages will be upgraded:
  ca-certificates
Preconfiguring packages ...
1 upgraded, 0 newly installed, 0 to remove and 266 not upgraded.
changed: [kovalart-3]
The following packages will be upgraded:
  ca-certificates
1 upgraded, 0 newly installed, 0 to remove and 266 not upgraded.
changed: [kovalart-1]
The following packages will be upgraded:
  ca-certificates
1 upgraded, 0 newly installed, 0 to remove and 266 not upgraded.
changed: [kovalart-2]

TASK [init : Install Rsyslog] **************************************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [init : Add the Rsyslog configuration for the Telegraf] *******************
changed: [kovalart-2]
changed: [kovalart-3]
changed: [kovalart-1]

TASK [init : Run Rsyslog] ******************************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [init : Create backup user] ***********************************************
changed: [kovalart-1]
changed: [kovalart-2]
changed: [kovalart-3]

TASK [init : Ensure .ssh directory exists for backup user] *********************
changed: [kovalart-1]
changed: [kovalart-2]
changed: [kovalart-3]

TASK [init : Generate SSH keypair for backup user] *****************************
changed: [kovalart-1]
changed: [kovalart-3]
changed: [kovalart-2]

TASK [init : Add backup server SSH key to known hosts] *************************
changed: [kovalart-1]
changed: [kovalart-2]
changed: [kovalart-3]

TASK [init : Ensure /home/backup/restore directory is created] *****************
changed: [kovalart-2]
changed: [kovalart-1]
changed: [kovalart-3]

TASK [init : Ensure Duplicity is installed] ************************************
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 266 not upgraded.
changed: [kovalart-3]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 266 not upgraded.
changed: [kovalart-2]
The following additional packages will be installed:
  librsync2 python3-bcrypt python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python3-gssapi
The following NEW packages will be installed:
  duplicity librsync2 python3-bcrypt python3-fasteners python3-future
  python3-lockfile python3-monotonic python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 266 not upgraded.
changed: [kovalart-1]

RUNNING HANDLER [init : restart rsyslog] ***************************************
changed: [kovalart-3]
changed: [kovalart-2]
changed: [kovalart-1]
[WARNING]: Could not match supplied host pattern, ignoring: children

PLAY [DNS server tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [bind : Install Bind9] ****************************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data libdpkg-perl
  libfile-fcntllock-perl libssl1.1 python3-ply
Suggested packages:
  bind-doc resolvconf debian-keyring gcc | c-compiler binutils bzr libssl-doc
  dpkg-dev python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data libdpkg-perl libfile-fcntllock-perl
  libssl-dev pkg-config python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs libssl1.1
3 upgraded, 9 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-3]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data libdpkg-perl
  libfile-fcntllock-perl libssl1.1 python3-ply
Suggested packages:
  bind-doc resolvconf debian-keyring gcc | c-compiler binutils bzr libssl-doc
  dpkg-dev python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data libdpkg-perl libfile-fcntllock-perl
  libssl-dev pkg-config python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs libssl1.1
3 upgraded, 9 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]
The following additional packages will be installed:
  bind9-dnsutils bind9-libs bind9-utils dns-root-data libdpkg-perl
  libfile-fcntllock-perl libssl1.1 python3-ply
Suggested packages:
  bind-doc resolvconf debian-keyring gcc | c-compiler binutils bzr libssl-doc
  dpkg-dev python-ply-doc
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data libdpkg-perl libfile-fcntllock-perl
  libssl-dev pkg-config python3-dnspython python3-ply
The following packages will be upgraded:
  bind9-dnsutils bind9-libs libssl1.1
3 upgraded, 9 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]

TASK [bind : Configure DNS forwarders] *****************************************
changed: [kovalart-2]
changed: [kovalart-1]
changed: [kovalart-3]

TASK [bind : Configure DNS] ****************************************************
changed: [kovalart-1]
changed: [kovalart-3]
changed: [kovalart-2]

TASK [bind : Configure Master Zone] ********************************************
skipping: [kovalart-1]
skipping: [kovalart-2]
changed: [kovalart-3]

TASK [bind : Configure Reverse Zone] *******************************************
skipping: [kovalart-1]
skipping: [kovalart-2]
changed: [kovalart-3]

TASK [bind : Run handlers] *****************************************************

RUNNING HANDLER [bind : restart bind9] *****************************************
changed: [kovalart-3]
changed: [kovalart-2]
changed: [kovalart-1]

RUNNING HANDLER [bind : restart rndc] ******************************************
changed: [kovalart-2]
changed: [kovalart-3]
changed: [kovalart-1]

TASK [bind : Ensure Bind9 service is running and enabled] **********************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [bind : Install Bind exporter] ********************************************
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]
The following NEW packages will be installed:
  prometheus-bind-exporter
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-3]

TASK [bind : Ensure bind exporter is running and enabled] **********************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [bind : Create CNAME records for DNS instances] ***************************
skipping: [kovalart-1] => (item={'service': 'ns-1', 'target': 'kovalart-1'}) 
skipping: [kovalart-1] => (item={'service': 'ns-2', 'target': 'kovalart-2'}) 
skipping: [kovalart-1] => (item={'service': 'ns-3', 'target': 'kovalart-3'}) 
skipping: [kovalart-2] => (item={'service': 'ns-1', 'target': 'kovalart-1'}) 
skipping: [kovalart-2] => (item={'service': 'ns-2', 'target': 'kovalart-2'}) 
skipping: [kovalart-2] => (item={'service': 'ns-3', 'target': 'kovalart-3'}) 
changed: [kovalart-3] => (item={'service': 'ns-1', 'target': 'kovalart-1'})
changed: [kovalart-3] => (item={'service': 'ns-2', 'target': 'kovalart-2'})
changed: [kovalart-3] => (item={'service': 'ns-3', 'target': 'kovalart-3'})

PLAY [Resolv.conf task] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-3]
ok: [kovalart-2]

TASK [resolv_dns : Shut down systemd-resolved] *********************************
changed: [kovalart-1]
changed: [kovalart-2]
changed: [kovalart-3]

TASK [resolv_dns : Change resolv.conf on all VMs] ******************************
changed: [kovalart-1]
changed: [kovalart-2]
changed: [kovalart-3]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Install mysql] ***************************************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common
  mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libwww-perl mailx tinyca
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libencode-locale-perl libevent-core-2.1-7
  libevent-pthreads-2.1-7 libfcgi-perl libhtml-parser-perl libhtml-tagset-perl
  libhtml-template-perl libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 liburi-perl mecab-ipadic mecab-ipadic-utf8
  mecab-utils mysql-client-8.0 mysql-client-core-8.0 mysql-common mysql-server
  mysql-server-8.0 mysql-server-core-8.0
0 upgraded, 24 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]

TASK [mysql : copy the mysql config file and restart mysql server] *************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [mysql : Start mysql] *****************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Install required Python Library] *********************************
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]
Suggested packages:
  python-pymysql-doc
The following NEW packages will be installed:
  python3-pymysql
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]

TASK [mysql : MySQL database] **************************************************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [mysql : MySQL user] ******************************************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [mysql : Create MySQL exporter user] **************************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [mysql : Install Exporter] ************************************************
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]
The following additional packages will be installed:
  daemon
The following NEW packages will be installed:
  daemon prometheus-mysqld-exporter
0 upgraded, 2 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]

TASK [mysql : Update the MySQL exporter] ***************************************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [mysql : Copy the config file] ********************************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [mysql : Start Mysql exporter] ********************************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [mysql : Ensure that mysql directory exists] ******************************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [kovalart-1]
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [kovalart-2]

TASK [mysql : Create MySQL user named backup with required privileges] *********
changed: [kovalart-2]
changed: [kovalart-1]

TASK [mysql : Ensure /home/backup/.my.cnf file is created] *********************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [mysql : Ensure user backup can create MySQL dumps without errors] ********
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Fail if the dump command did not execute successfully] ***********
skipping: [kovalart-1]
skipping: [kovalart-2]

TASK [mysql : Schedule MySQL backups with Cron] ********************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [mysql : Create MySQL user named replica with required privileges] ********
changed: [kovalart-2]
changed: [kovalart-1]

TASK [mysql : Read only mode for the Replica MySQL host] ***********************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [mysql : Create CNAME records for MySQL instances 1] **********************
ok: [kovalart-2] => (item=None)
changed: [kovalart-1] => (item=None)
changed: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
changed: [kovalart-2]
changed: [kovalart-1]

RUNNING HANDLER [mysql : restart mysql] ****************************************
changed: [kovalart-1]
changed: [kovalart-2]

RUNNING HANDLER [mysql : restart mysql-exporter] *******************************
changed: [kovalart-1]
changed: [kovalart-2]

RUNNING HANDLER [mysql : Reset MySQL source] ***********************************
skipping: [kovalart-2] => (item=stopreplica) 
skipping: [kovalart-2] => (item=resetprimary) 
ok: [kovalart-1] => (item=stopreplica)
changed: [kovalart-1] => (item=resetprimary)

RUNNING HANDLER [mysql : Reset MySQL replica] **********************************
skipping: [kovalart-1] => (item=stopreplica) 
skipping: [kovalart-1] => (item=changeprimary) 
skipping: [kovalart-1] => (item=resetreplica) 
skipping: [kovalart-1] => (item=startreplica) 
ok: [kovalart-2] => (item=stopreplica)
changed: [kovalart-2] => (item=changeprimary)
changed: [kovalart-2] => (item=resetreplica)
changed: [kovalart-2] => (item=startreplica)

PLAY [Prometheus tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [prometheus : Install Prometheus] *****************************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc
Suggested packages:
  apache2 | lighttpd | httpd npm
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libc-ares2 libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libnode64 node-jquery nodejs
  nodejs-doc prometheus
0 upgraded, 19 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-3]

TASK [prometheus : Copy Prometheus Configuration] ******************************
changed: [kovalart-3]

TASK [prometheus : Copy Prometheus service configuration] **********************
changed: [kovalart-3]

TASK [prometheus : Start the prometheus] ***************************************
ok: [kovalart-3]

TASK [prometheus : Create CNAME record for prometheus] *************************
changed: [kovalart-3]

RUNNING HANDLER [prometheus : restart prometheus] ******************************
changed: [kovalart-3]

PLAY [Docker tasks] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [docker : Install Docker.io package] **************************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz runc ubuntu-fan
0 upgraded, 8 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz runc ubuntu-fan
0 upgraded, 8 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-3]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base libidn11 pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io libidn11 pigz runc ubuntu-fan
0 upgraded, 8 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]

TASK [docker : Install python3-docker package] *********************************
The following additional packages will be installed:
  python3-websocket
The following NEW packages will be installed:
  python3-docker python3-websocket
0 upgraded, 2 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-3]
The following additional packages will be installed:
  python3-websocket
The following NEW packages will be installed:
  python3-docker python3-websocket
0 upgraded, 2 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]
The following additional packages will be installed:
  python3-websocket
The following NEW packages will be installed:
  python3-docker python3-websocket
0 upgraded, 2 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]

TASK [docker : Ensure Docker daemon is running and enabled] ********************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

PLAY [Grafana Tasks] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [grafana : Create Grafana directories] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [kovalart-3] => (item=provisioning/dashboards)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [kovalart-3] => (item=provisioning/datasources)

TASK [grafana : Copy Grafana Configuration] ************************************
changed: [kovalart-3] => (item=None)
changed: [kovalart-3] => (item=None)
changed: [kovalart-3] => (item=None)
changed: [kovalart-3] => (item=None)
changed: [kovalart-3] => (item=None)
changed: [kovalart-3] => (item=None)
changed: [kovalart-3]

TASK [grafana : Pull Grafana Docker image] *************************************
changed: [kovalart-3]

TASK [grafana : Start Grafana container] ***************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [kovalart-3]

TASK [grafana : Create CNAME record for Grafana] *******************************
changed: [kovalart-3]

RUNNING HANDLER [grafana : restart grafana] ************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "restarted": false,
+    "restarted": true,
     "running": true
 }

changed: [kovalart-3]

PLAY [Agama tasks] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Agama directory] *************************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [kovalart-2]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [kovalart-1]

TASK [agama : Configure AGAMA application] *************************************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [agama : Download agama.py] ***********************************************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [agama : Download Dockerfile] *********************************************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [agama : Build agama image] ***********************************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [agama : Create Agama Containers] *****************************************
changed: [kovalart-1] => (item=None)
changed: [kovalart-2] => (item=None)
changed: [kovalart-2] => (item=None)
changed: [kovalart-1] => (item=None)
changed: [kovalart-2] => (item=None)
changed: [kovalart-2]
changed: [kovalart-1] => (item=None)
changed: [kovalart-1]

TASK [agama : Gather information about all running containers] *****************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Remove extra Agama Containers] ***********************************
skipping: [kovalart-1] => (item=agama3) 
skipping: [kovalart-1] => (item=agama2) 
skipping: [kovalart-1] => (item=agama1) 
skipping: [kovalart-2] => (item=agama3) 
skipping: [kovalart-2] => (item=agama2) 
skipping: [kovalart-2] => (item=agama1) 

TASK [agama : Create CNAME records for Agama instances] ************************
changed: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
changed: [kovalart-1] => (item=None)
changed: [kovalart-1]
changed: [kovalart-2] => (item=None)
changed: [kovalart-2]

PLAY [Web server tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [nginx : Ensure nginx is installed] ***************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libfontconfig1 libgd3 libjbig0
  libjpeg-turbo8 libjpeg8 libnginx-mod-http-image-filter
  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libtiff5
  libwebp6 libxpm4 nginx nginx-common nginx-core
0 upgraded, 17 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-3]

TASK [nginx : Copy Nginx default config to sites-enabled] **********************
changed: [kovalart-3]
changed: [kovalart-2]
changed: [kovalart-1]

TASK [nginx : start nginx] *****************************************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [nginx : Install exporter] ************************************************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-3]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]

TASK [nginx : Run the nginx exporter] ******************************************
changed: [kovalart-1]
changed: [kovalart-2]
changed: [kovalart-3]

RUNNING HANDLER [nginx : restart nginx] ****************************************
changed: [kovalart-3]
changed: [kovalart-2]
changed: [kovalart-1]

RUNNING HANDLER [nginx : restart nginx exporter] *******************************
changed: [kovalart-3]
changed: [kovalart-1]
changed: [kovalart-2]

PLAY [Influxdb tasks] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [influxdb : Install influxdb] *********************************************
changed: [kovalart-3]

TASK [influxdb : Dpkg InfluxDB] ************************************************
Selecting previously unselected package influxdb.
(Reading database ... 66686 files and directories currently installed.)
Preparing to unpack .../influxdb_1.8.10_amd64.deb ...
Unpacking influxdb (1.8.10-1) ...
Setting up influxdb (1.8.10-1) ...
Processing triggers for man-db (2.9.1-1) ...
changed: [kovalart-3]

TASK [influxdb : Change the config for Influxdb] *******************************
changed: [kovalart-3]

TASK [influxdb : Ensure InfluxDB is enabled and running] ***********************
changed: [kovalart-3]

TASK [influxdb : Download Telegraf] ********************************************
changed: [kovalart-3]

TASK [influxdb : Install Telegraf] *********************************************
Selecting previously unselected package telegraf.
(Reading database ... 66711 files and directories currently installed.)
Preparing to unpack /home/ubuntu/telegraf.deb ...
Unpacking telegraf (1.28.2-1) ...
Setting up telegraf (1.28.2-1) ...
changed: [kovalart-3]

TASK [influxdb : Configure Telegraf for syslog input and InfluxDB output] ******
changed: [kovalart-3]

TASK [influxdb : Start Telegraf service] ***************************************
changed: [kovalart-3]

TASK [influxdb : Download InfluxDB Stats Exporter binary] **********************
changed: [kovalart-3]

TASK [influxdb : Create systemd service for InfluxDB Stats Exporter] ***********
changed: [kovalart-3]

TASK [influxdb : Start InfluxDB Stats Exporter] ********************************
changed: [kovalart-3] => (item=prometheus-influxdb-stats-exporter)

TASK [influxdb : Ensure that influxdb directory exists] ************************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 34,
+    "owner": 34,
     "path": "/home/backup/influxdb",
-    "state": "absent"
+    "state": "directory"
 }

changed: [kovalart-3]

TASK [influxdb : Ensure user backup can create InfluxDB dumps without errors] ***
ok: [kovalart-3]

TASK [influxdb : Fail if the dump command did not execute successfully] ********
skipping: [kovalart-3]

TASK [influxdb : InfluxDB backup cron job] *************************************
changed: [kovalart-3]

TASK [influxdb : Create CNAME record for Influxdb] *****************************
changed: [kovalart-3]

TASK [pinger : Create "pinger" user] *******************************************
changed: [kovalart-3]

TASK [pinger : Install fping] **************************************************
The following NEW packages will be installed:
  fping
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-3]

TASK [pinger : Create a directory /etc/pinger] *********************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/etc/pinger",
-    "state": "absent"
+    "state": "directory"
 }

changed: [kovalart-3]

TASK [pinger : Copy service to destination] ************************************
changed: [kovalart-3]

TASK [pinger : Copy Pinger service file] ***************************************
changed: [kovalart-3]

TASK [pinger : Copy Pinger.conf file] ******************************************
changed: [kovalart-3]

TASK [pinger : Restart daemon] *************************************************
ok: [kovalart-3]

TASK [pinger : Start pinger] ***************************************************
changed: [kovalart-3]

RUNNING HANDLER [influxdb : restart influxdb-stats-exporter] *******************
changed: [kovalart-3]

RUNNING HANDLER [influxdb : restart influxdb] **********************************
changed: [kovalart-3]

RUNNING HANDLER [influxdb : restart telegraf] **********************************
changed: [kovalart-3]

RUNNING HANDLER [pinger : restart pinger] **************************************
changed: [kovalart-3]

PLAY [Haproxy tasks] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Install haproxy] ***********************************************
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]

TASK [haproxy : Copy the Haproxy config] ***************************************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [haproxy : Start the service] *********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [haproxy : Install prometheus-haproxy-exporter using APT] *****************
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]

TASK [haproxy : Configure haproxy.scrape-uri in /etc/default/prometheus-haproxy-exporter] ***
changed: [kovalart-2]
changed: [kovalart-1]

TASK [haproxy : Start haproxy exporter] ****************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [haproxy : Create CNAME records for HAproxy instances] ********************
ok: [kovalart-1] => (item=None)
changed: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
changed: [kovalart-2] => (item=None)
ok: [kovalart-1]
changed: [kovalart-2]

RUNNING HANDLER [haproxy : Restart Haproxy] ************************************
changed: [kovalart-2]
changed: [kovalart-1]

RUNNING HANDLER [haproxy : restart prometheus-haproxy-exporter] ****************
changed: [kovalart-2]
changed: [kovalart-1]

PLAY [Keepalived tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [keepalived : Install keepalived] *****************************************
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-2]
The following additional packages will be installed:
  ipvsadm libmysqlclient21 libnl-3-200 libnl-genl-3-200 libsensors-config
  libsensors5 libsnmp-base libsnmp35
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libmysqlclient21 libnl-3-200 libnl-genl-3-200
  libsensors-config libsensors5 libsnmp-base libsnmp35
0 upgraded, 9 newly installed, 0 to remove and 263 not upgraded.
changed: [kovalart-1]

TASK [keepalived : Copy check script to keepalived_script user's home folder] ***
changed: [kovalart-1]
changed: [kovalart-2]

TASK [keepalived : Copy the Keepalived config] *********************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [keepalived : Download Keepalived Exporter] *******************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [keepalived : Extract Keepalived Exporter] ********************************
changed: [kovalart-2]
changed: [kovalart-1]

TASK [keepalived : Create systemd unit file] ***********************************
changed: [kovalart-1]
changed: [kovalart-2]

TASK [keepalived : Reload systemd] *********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [keepalived : Start the service] ******************************************
changed: [kovalart-1] => (item=keepalived)
changed: [kovalart-2] => (item=keepalived)
changed: [kovalart-1] => (item=keepalived-exporter)
changed: [kovalart-2] => (item=keepalived-exporter)

RUNNING HANDLER [keepalived : Restart keepalived] ******************************
changed: [kovalart-2]
changed: [kovalart-1]

PLAY RECAP *********************************************************************
kovalart-1                 : ok=91   changed=68   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
kovalart-2                 : ok=91   changed=69   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
kovalart-3                 : ok=84   changed=65   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ ansible-playbook infra.yaml --diff

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [init : Update APT cache] *************************************************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [init : Install Prometheus nodes] *****************************************
ok: [kovalart-1]
ok: [kovalart-3]
ok: [kovalart-2]

TASK [init : Ensure the Node Exporters are started] ****************************
ok: [kovalart-1]
ok: [kovalart-3]
ok: [kovalart-2]

TASK [init : Ensure ca-certificates is installed with a specific version] ******
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Install Rsyslog] **************************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Add the Rsyslog configuration for the Telegraf] *******************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [init : Run Rsyslog] ******************************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Create backup user] ***********************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [init : Ensure .ssh directory exists for backup user] *********************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Generate SSH keypair for backup user] *****************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [init : Add backup server SSH key to known hosts] *************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [init : Ensure /home/backup/restore directory is created] *****************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [init : Ensure Duplicity is installed] ************************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]
[WARNING]: Could not match supplied host pattern, ignoring: children

PLAY [DNS server tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [bind : Install Bind9] ****************************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [bind : Configure DNS forwarders] *****************************************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [bind : Configure DNS] ****************************************************
ok: [kovalart-1]
ok: [kovalart-3]
ok: [kovalart-2]

TASK [bind : Configure Master Zone] ********************************************
skipping: [kovalart-1]
skipping: [kovalart-2]
ok: [kovalart-3]

TASK [bind : Configure Reverse Zone] *******************************************
skipping: [kovalart-1]
skipping: [kovalart-2]
ok: [kovalart-3]

TASK [bind : Run handlers] *****************************************************

TASK [bind : Ensure Bind9 service is running and enabled] **********************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [bind : Install Bind exporter] ********************************************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [bind : Ensure bind exporter is running and enabled] **********************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [bind : Create CNAME records for DNS instances] ***************************
skipping: [kovalart-1] => (item={'service': 'ns-1', 'target': 'kovalart-1'}) 
skipping: [kovalart-1] => (item={'service': 'ns-2', 'target': 'kovalart-2'}) 
skipping: [kovalart-1] => (item={'service': 'ns-3', 'target': 'kovalart-3'}) 
skipping: [kovalart-2] => (item={'service': 'ns-1', 'target': 'kovalart-1'}) 
skipping: [kovalart-2] => (item={'service': 'ns-2', 'target': 'kovalart-2'}) 
skipping: [kovalart-2] => (item={'service': 'ns-3', 'target': 'kovalart-3'}) 
ok: [kovalart-3] => (item={'service': 'ns-1', 'target': 'kovalart-1'})
ok: [kovalart-3] => (item={'service': 'ns-2', 'target': 'kovalart-2'})
ok: [kovalart-3] => (item={'service': 'ns-3', 'target': 'kovalart-3'})

PLAY [Resolv.conf task] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [resolv_dns : Shut down systemd-resolved] *********************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [resolv_dns : Change resolv.conf on all VMs] ******************************
ok: [kovalart-1]
ok: [kovalart-3]
ok: [kovalart-2]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Install mysql] ***************************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : copy the mysql config file and restart mysql server] *************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Start mysql] *****************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Install required Python Library] *********************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : MySQL database] **************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : MySQL user] ******************************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Create MySQL exporter user] **************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Install Exporter] ************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Update the MySQL exporter] ***************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Copy the config file] ********************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Start Mysql exporter] ********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Ensure that mysql directory exists] ******************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Create MySQL user named backup with required privileges] *********
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Ensure /home/backup/.my.cnf file is created] *********************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Ensure user backup can create MySQL dumps without errors] ********
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Fail if the dump command did not execute successfully] ***********
skipping: [kovalart-1]
skipping: [kovalart-2]

TASK [mysql : Schedule MySQL backups with Cron] ********************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Create MySQL user named replica with required privileges] ********
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Read only mode for the Replica MySQL host] ***********************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Create CNAME records for MySQL instances 1] **********************
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-2]
ok: [kovalart-1] => (item=None)
ok: [kovalart-1]

PLAY [Prometheus tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [prometheus : Install Prometheus] *****************************************
ok: [kovalart-3]

TASK [prometheus : Copy Prometheus Configuration] ******************************
ok: [kovalart-3]

TASK [prometheus : Copy Prometheus service configuration] **********************
ok: [kovalart-3]

TASK [prometheus : Start the prometheus] ***************************************
ok: [kovalart-3]

TASK [prometheus : Create CNAME record for prometheus] *************************
ok: [kovalart-3]

PLAY [Docker tasks] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [docker : Install Docker.io package] **************************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [docker : Install python3-docker package] *********************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [docker : Ensure Docker daemon is running and enabled] ********************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

PLAY [Grafana Tasks] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [grafana : Create Grafana directories] ************************************
ok: [kovalart-3] => (item=provisioning/dashboards)
ok: [kovalart-3] => (item=provisioning/datasources)

TASK [grafana : Copy Grafana Configuration] ************************************
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3]

TASK [grafana : Pull Grafana Docker image] *************************************
ok: [kovalart-3]

TASK [grafana : Start Grafana container] ***************************************
ok: [kovalart-3]

TASK [grafana : Create CNAME record for Grafana] *******************************
ok: [kovalart-3]

PLAY [Agama tasks] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Agama directory] *************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Configure AGAMA application] *************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [agama : Download agama.py] ***********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [agama : Download Dockerfile] *********************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Build agama image] ***********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [agama : Create Agama Containers] *****************************************
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-2]
ok: [kovalart-1] => (item=None)
ok: [kovalart-1]

TASK [agama : Gather information about all running containers] *****************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Remove extra Agama Containers] ***********************************
skipping: [kovalart-1] => (item=agama3) 
skipping: [kovalart-1] => (item=agama2) 
skipping: [kovalart-1] => (item=agama1) 
skipping: [kovalart-2] => (item=agama3) 
skipping: [kovalart-2] => (item=agama2) 
skipping: [kovalart-2] => (item=agama1) 

TASK [agama : Create CNAME records for Agama instances] ************************
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-1]
ok: [kovalart-2] => (item=None)
ok: [kovalart-2]

PLAY [Web server tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [nginx : Ensure nginx is installed] ***************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [nginx : Copy Nginx default config to sites-enabled] **********************
ok: [kovalart-1]
ok: [kovalart-3]
ok: [kovalart-2]

TASK [nginx : start nginx] *****************************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [nginx : Install exporter] ************************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [nginx : Run the nginx exporter] ******************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

PLAY [Influxdb tasks] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [influxdb : Install influxdb] *********************************************
ok: [kovalart-3]

TASK [influxdb : Dpkg InfluxDB] ************************************************
ok: [kovalart-3]

TASK [influxdb : Change the config for Influxdb] *******************************
ok: [kovalart-3]

TASK [influxdb : Ensure InfluxDB is enabled and running] ***********************
ok: [kovalart-3]

TASK [influxdb : Download Telegraf] ********************************************
ok: [kovalart-3]

TASK [influxdb : Install Telegraf] *********************************************
ok: [kovalart-3]

TASK [influxdb : Configure Telegraf for syslog input and InfluxDB output] ******
ok: [kovalart-3]

TASK [influxdb : Start Telegraf service] ***************************************
ok: [kovalart-3]

TASK [influxdb : Download InfluxDB Stats Exporter binary] **********************
ok: [kovalart-3]

TASK [influxdb : Create systemd service for InfluxDB Stats Exporter] ***********
ok: [kovalart-3]

TASK [influxdb : Start InfluxDB Stats Exporter] ********************************
ok: [kovalart-3] => (item=prometheus-influxdb-stats-exporter)

TASK [influxdb : Ensure that influxdb directory exists] ************************
ok: [kovalart-3]

TASK [influxdb : Ensure user backup can create InfluxDB dumps without errors] ***
ok: [kovalart-3]

TASK [influxdb : Fail if the dump command did not execute successfully] ********
skipping: [kovalart-3]

TASK [influxdb : InfluxDB backup cron job] *************************************
ok: [kovalart-3]

TASK [influxdb : Create CNAME record for Influxdb] *****************************
ok: [kovalart-3]

TASK [pinger : Create "pinger" user] *******************************************
ok: [kovalart-3]

TASK [pinger : Install fping] **************************************************
ok: [kovalart-3]

TASK [pinger : Create a directory /etc/pinger] *********************************
ok: [kovalart-3]

TASK [pinger : Copy service to destination] ************************************
ok: [kovalart-3]

TASK [pinger : Copy Pinger service file] ***************************************
ok: [kovalart-3]

TASK [pinger : Copy Pinger.conf file] ******************************************
ok: [kovalart-3]

TASK [pinger : Restart daemon] *************************************************
ok: [kovalart-3]

TASK [pinger : Start pinger] ***************************************************
ok: [kovalart-3]

PLAY [Haproxy tasks] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Install haproxy] ***********************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Copy the Haproxy config] ***************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Start the service] *********************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Install prometheus-haproxy-exporter using APT] *****************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Configure haproxy.scrape-uri in /etc/default/prometheus-haproxy-exporter] ***
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Start haproxy exporter] ****************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Create CNAME records for HAproxy instances] ********************
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-1]
ok: [kovalart-2] => (item=None)
ok: [kovalart-2]

PLAY [Keepalived tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Install keepalived] *****************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Copy check script to keepalived_script user's home folder] ***
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Copy the Keepalived config] *********************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Download Keepalived Exporter] *******************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Extract Keepalived Exporter] ********************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Create systemd unit file] ***********************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Reload systemd] *********************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Start the service] ******************************************
ok: [kovalart-2] => (item=keepalived)
ok: [kovalart-1] => (item=keepalived)
ok: [kovalart-2] => (item=keepalived-exporter)
ok: [kovalart-1] => (item=keepalived-exporter)

PLAY RECAP *********************************************************************
kovalart-1                 : ok=80   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   
kovalart-2                 : ok=80   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   
kovalart-3                 : ok=73   changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ ansible all -b -m reboot -a test_command=uptime
kovalart-3 | CHANGED => {
    "changed": true,
    "elapsed": 41,
    "rebooted": true
}
kovalart-1 | CHANGED => {
    "changed": true,
    "elapsed": 41,
    "rebooted": true
}
kovalart-2 | CHANGED => {
    "changed": true,
    "elapsed": 52,
    "rebooted": true
}
+ ansible-playbook infra.yaml --diff

PLAY [Initial setup] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Update APT cache] *************************************************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [init : Install Prometheus nodes] *****************************************
ok: [kovalart-1]
ok: [kovalart-3]
ok: [kovalart-2]

TASK [init : Ensure the Node Exporters are started] ****************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [init : Ensure ca-certificates is installed with a specific version] ******
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Install Rsyslog] **************************************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [init : Add the Rsyslog configuration for the Telegraf] *******************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [init : Run Rsyslog] ******************************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Create backup user] ***********************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Ensure .ssh directory exists for backup user] *********************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [init : Generate SSH keypair for backup user] *****************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [init : Add backup server SSH key to known hosts] *************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [init : Ensure /home/backup/restore directory is created] *****************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [init : Ensure Duplicity is installed] ************************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]
[WARNING]: Could not match supplied host pattern, ignoring: children

PLAY [DNS server tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [bind : Install Bind9] ****************************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [bind : Configure DNS forwarders] *****************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [bind : Configure DNS] ****************************************************
ok: [kovalart-1]
ok: [kovalart-3]
ok: [kovalart-2]

TASK [bind : Configure Master Zone] ********************************************
skipping: [kovalart-1]
skipping: [kovalart-2]
ok: [kovalart-3]

TASK [bind : Configure Reverse Zone] *******************************************
skipping: [kovalart-1]
skipping: [kovalart-2]
ok: [kovalart-3]

TASK [bind : Run handlers] *****************************************************

TASK [bind : Ensure Bind9 service is running and enabled] **********************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [bind : Install Bind exporter] ********************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [bind : Ensure bind exporter is running and enabled] **********************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [bind : Create CNAME records for DNS instances] ***************************
skipping: [kovalart-1] => (item={'service': 'ns-1', 'target': 'kovalart-1'}) 
skipping: [kovalart-1] => (item={'service': 'ns-2', 'target': 'kovalart-2'}) 
skipping: [kovalart-1] => (item={'service': 'ns-3', 'target': 'kovalart-3'}) 
skipping: [kovalart-2] => (item={'service': 'ns-1', 'target': 'kovalart-1'}) 
skipping: [kovalart-2] => (item={'service': 'ns-2', 'target': 'kovalart-2'}) 
skipping: [kovalart-2] => (item={'service': 'ns-3', 'target': 'kovalart-3'}) 
ok: [kovalart-3] => (item={'service': 'ns-1', 'target': 'kovalart-1'})
ok: [kovalart-3] => (item={'service': 'ns-2', 'target': 'kovalart-2'})
ok: [kovalart-3] => (item={'service': 'ns-3', 'target': 'kovalart-3'})

PLAY [Resolv.conf task] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [resolv_dns : Shut down systemd-resolved] *********************************
ok: [kovalart-3]
ok: [kovalart-1]
ok: [kovalart-2]

TASK [resolv_dns : Change resolv.conf on all VMs] ******************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

PLAY [Database server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Install mysql] ***************************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : copy the mysql config file and restart mysql server] *************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Start mysql] *****************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Install required Python Library] *********************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : MySQL database] **************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : MySQL user] ******************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Create MySQL exporter user] **************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Install Exporter] ************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Update the MySQL exporter] ***************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Copy the config file] ********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Start Mysql exporter] ********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Ensure that mysql directory exists] ******************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Create MySQL user named backup with required privileges] *********
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Ensure /home/backup/.my.cnf file is created] *********************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Ensure user backup can create MySQL dumps without errors] ********
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Fail if the dump command did not execute successfully] ***********
skipping: [kovalart-1]
skipping: [kovalart-2]

TASK [mysql : Schedule MySQL backups with Cron] ********************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Create MySQL user named replica with required privileges] ********
ok: [kovalart-1]
ok: [kovalart-2]

TASK [mysql : Read only mode for the Replica MySQL host] ***********************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [mysql : Create CNAME records for MySQL instances 1] **********************
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-2]
ok: [kovalart-1]

PLAY [Prometheus tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [prometheus : Install Prometheus] *****************************************
ok: [kovalart-3]

TASK [prometheus : Copy Prometheus Configuration] ******************************
ok: [kovalart-3]

TASK [prometheus : Copy Prometheus service configuration] **********************
ok: [kovalart-3]

TASK [prometheus : Start the prometheus] ***************************************
ok: [kovalart-3]

TASK [prometheus : Create CNAME record for prometheus] *************************
ok: [kovalart-3]

PLAY [Docker tasks] ************************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]
ok: [kovalart-2]
ok: [kovalart-1]

TASK [docker : Install Docker.io package] **************************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [docker : Install python3-docker package] *********************************
ok: [kovalart-2]
ok: [kovalart-3]
ok: [kovalart-1]

TASK [docker : Ensure Docker daemon is running and enabled] ********************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

PLAY [Grafana Tasks] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [grafana : Create Grafana directories] ************************************
ok: [kovalart-3] => (item=provisioning/dashboards)
ok: [kovalart-3] => (item=provisioning/datasources)

TASK [grafana : Copy Grafana Configuration] ************************************
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3] => (item=None)
ok: [kovalart-3]

TASK [grafana : Pull Grafana Docker image] *************************************
ok: [kovalart-3]

TASK [grafana : Start Grafana container] ***************************************
ok: [kovalart-3]

TASK [grafana : Create CNAME record for Grafana] *******************************
ok: [kovalart-3]

PLAY [Agama tasks] *************************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [agama : Agama directory] *************************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [agama : Configure AGAMA application] *************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Download agama.py] ***********************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Download Dockerfile] *********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [agama : Build agama image] ***********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [agama : Create Agama Containers] *****************************************
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-1]
ok: [kovalart-2]

TASK [agama : Gather information about all running containers] *****************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [agama : Remove extra Agama Containers] ***********************************
skipping: [kovalart-1] => (item=agama3) 
skipping: [kovalart-1] => (item=agama2) 
skipping: [kovalart-1] => (item=agama1) 
skipping: [kovalart-2] => (item=agama3) 
skipping: [kovalart-2] => (item=agama2) 
skipping: [kovalart-2] => (item=agama1) 

TASK [agama : Create CNAME records for Agama instances] ************************
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-1] => (item=None)
ok: [kovalart-1]
ok: [kovalart-2] => (item=None)
ok: [kovalart-2]

PLAY [Web server tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [nginx : Ensure nginx is installed] ***************************************
ok: [kovalart-2]
ok: [kovalart-1]
ok: [kovalart-3]

TASK [nginx : Copy Nginx default config to sites-enabled] **********************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [nginx : start nginx] *****************************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [nginx : Install exporter] ************************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

TASK [nginx : Run the nginx exporter] ******************************************
ok: [kovalart-1]
ok: [kovalart-2]
ok: [kovalart-3]

PLAY [Influxdb tasks] **********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-3]

TASK [influxdb : Install influxdb] *********************************************
ok: [kovalart-3]

TASK [influxdb : Dpkg InfluxDB] ************************************************
ok: [kovalart-3]

TASK [influxdb : Change the config for Influxdb] *******************************
ok: [kovalart-3]

TASK [influxdb : Ensure InfluxDB is enabled and running] ***********************
ok: [kovalart-3]

TASK [influxdb : Download Telegraf] ********************************************
ok: [kovalart-3]

TASK [influxdb : Install Telegraf] *********************************************
ok: [kovalart-3]

TASK [influxdb : Configure Telegraf for syslog input and InfluxDB output] ******
ok: [kovalart-3]

TASK [influxdb : Start Telegraf service] ***************************************
ok: [kovalart-3]

TASK [influxdb : Download InfluxDB Stats Exporter binary] **********************
ok: [kovalart-3]

TASK [influxdb : Create systemd service for InfluxDB Stats Exporter] ***********
ok: [kovalart-3]

TASK [influxdb : Start InfluxDB Stats Exporter] ********************************
ok: [kovalart-3] => (item=prometheus-influxdb-stats-exporter)

TASK [influxdb : Ensure that influxdb directory exists] ************************
ok: [kovalart-3]

TASK [influxdb : Ensure user backup can create InfluxDB dumps without errors] ***
ok: [kovalart-3]

TASK [influxdb : Fail if the dump command did not execute successfully] ********
skipping: [kovalart-3]

TASK [influxdb : InfluxDB backup cron job] *************************************
ok: [kovalart-3]

TASK [influxdb : Create CNAME record for Influxdb] *****************************
ok: [kovalart-3]

TASK [pinger : Create "pinger" user] *******************************************
ok: [kovalart-3]

TASK [pinger : Install fping] **************************************************
ok: [kovalart-3]

TASK [pinger : Create a directory /etc/pinger] *********************************
ok: [kovalart-3]

TASK [pinger : Copy service to destination] ************************************
ok: [kovalart-3]

TASK [pinger : Copy Pinger service file] ***************************************
ok: [kovalart-3]

TASK [pinger : Copy Pinger.conf file] ******************************************
ok: [kovalart-3]

TASK [pinger : Restart daemon] *************************************************
ok: [kovalart-3]

TASK [pinger : Start pinger] ***************************************************
ok: [kovalart-3]

PLAY [Haproxy tasks] ***********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Install haproxy] ***********************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [haproxy : Copy the Haproxy config] ***************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Start the service] *********************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Install prometheus-haproxy-exporter using APT] *****************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [haproxy : Configure haproxy.scrape-uri in /etc/default/prometheus-haproxy-exporter] ***
ok: [kovalart-2]
ok: [kovalart-1]

TASK [haproxy : Start haproxy exporter] ****************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [haproxy : Create CNAME records for HAproxy instances] ********************
ok: [kovalart-1] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-2] => (item=None)
ok: [kovalart-2]
ok: [kovalart-1] => (item=None)
ok: [kovalart-1]

PLAY [Keepalived tasks] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Install keepalived] *****************************************
ok: [kovalart-2]
ok: [kovalart-1]

TASK [keepalived : Copy check script to keepalived_script user's home folder] ***
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Copy the Keepalived config] *********************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Download Keepalived Exporter] *******************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Extract Keepalived Exporter] ********************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Create systemd unit file] ***********************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Reload systemd] *********************************************
ok: [kovalart-1]
ok: [kovalart-2]

TASK [keepalived : Start the service] ******************************************
ok: [kovalart-1] => (item=keepalived)
ok: [kovalart-2] => (item=keepalived)
ok: [kovalart-1] => (item=keepalived-exporter)
ok: [kovalart-2] => (item=keepalived-exporter)

PLAY RECAP *********************************************************************
kovalart-1                 : ok=80   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   
kovalart-2                 : ok=80   changed=0    unreachable=0    failed=0    skipped=5    rescued=0    ignored=0   
kovalart-3                 : ok=73   changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ date
Tue Jan 16 10:16:04 EET 2024
